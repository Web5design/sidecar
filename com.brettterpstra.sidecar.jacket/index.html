<!DOCTYPE html>
<html lang="en" xml:lang="en">
	<head>
		<meta name="jacket.title" content="Sidecar" />
		<meta name="jacket.author" content="Brett Terpstra" />
		<meta name="jacket.url" content="http://brettterpstra.com" />
		<meta name="jacket.version" content="1.5" />
		<meta name="jacket.bounds" content="298x1418" />
		<meta name="jacket.variations" content="I have the blues so bad, It's not easy being green, White riot, Black power, Almost invisible, Blowout, Can you hear me Major Tom?" />


		<link rel="stylesheet" type="text/css" href="index.css"  />
		<script type="text/javascript">

		var timer;

		//When user changes jacket to yours, or Simplify starts with your jacket this event arrives
		Simplify.listenEvent(PMEvents.Ready, function(initial_state)
		{
			//This template jacket will fade in because of this line
			$('#message').text("").removeClass("show");
			$("body").animate({"opacity": ".85"},2000);

			// if (Simplify.playerState() == PMPlayerState.Stopped)
			// {
			// 	$('.progress span').css({top:"100%"});
			// }
			// else
			// {
			// 	$('.progress span').css({top:0});
			// }
			$('.progress span').css({top:"100%"});
			var updateProgress = function()
			{
				if (Simplify.playerState() == PMPlayerState.Playing || Simplify.playerState() == PMPlayerState.Paused)
				{
					Simplify.getTrackPlayedAmount(function(value)
					{
						$('.progress span').css({top:(Math.round(value*100/0.01)*0.01).toString() + "%"});
						if ($('body').hasClass('blowout') || $('body').hasClass('fadeaway')) {
							$('.progress span').css({'-webkit-filter': 'blur('+((value*105)+30)+'px)'});
						} else {
							$('.progress span').css({'-webkit-filter': 'blur(0)'});
						}
					});
				}
			}

			updateProgress(), setInterval(updateProgress, 1000);

			$(".jacket").click(function(ev){
				ev.preventDefault();
				if (ev.metaKey) {
					var percentage = (ev.pageY - $(this).offset().top)/$(this).height();
					Simplify.setTrackSeeking(Simplify.getTrackLength() * percentage);
				} else {
					Simplify.togglePlayback();
				}
			});

			//Activating application on double click
			$("body, html").dblclick(function()
			{
				$('#message').text("").removeClass("show");
				Simplify.nextTrack();
			});

		});

		//When variation changes, you can add/remove CSS-classes from body to keep track current variation
		Simplify.listenEvent(PMEvents.VariationChange, function(variation)
		{
			/* EXAMPLE CODE. IT WORKS! */

			if (variation.indexOf("I have the blues so bad") != -1)
			{
				$("body").addClass("blue");
			}
			else
			{
				$("body").removeClass("blue");
			}

			if (variation.indexOf("It's not easy being green") != -1)
			{
				$("body").addClass("green");
			}
			else
			{
				$("body").removeClass("green");
			}

			if (variation.indexOf("White riot") != -1)
			{
				$("body").addClass("white");
			}
			else
			{
				$("body").removeClass("white");
			}

			if (variation.indexOf("Black power") != -1)
			{
				$("body").addClass("black");
			}
			else
			{
				$("body").removeClass("black");
			}

			if (variation.indexOf("Almost invisible") != -1)
			{
				$("body").addClass("invisible");
			}
			else
			{
				$("body").removeClass("invisible");
			}

			if (variation.indexOf("Blowout") != -1)
			{
				$("body").addClass("blowout");
			}
			else
			{
				$("body").removeClass("blowout");
			}

			if (variation.indexOf("Can you hear me Major Tom") != -1)
			{
				$("body").addClass("fadeaway");
			}
			else
			{
				$("body").removeClass("fadeaway");
			}

		});

		//UI modifications on playback changes
		Simplify.listenEvent(PMEvents.PlaybackStateChange, function(state)
		{
			if (state == PMPlayerState.Paused)
			{
				$('body').addClass('paused');
				showMessage('paused');
			}
			else if (state == PMPlayerState.Playing)
			{
				$('body').removeClass('paused');
				showMessage('playing');
			}
			else
			{
				$('.progress').removeClass('paused');
				$('#message').fadeOut();
			}
		});

		//Track title arrived from Simplify
		Simplify.listenEvent(PMEvents.TrackInformationChange, function(artist, title, album)
		{
			//Undefined attributes means stopped playback.
			if (artist != undefined && title != undefined)
			{
				$(".title,.artist").fadeOut('fast',function() {
					$(".title").text(title);
					$(".artist").text(artist+" ");
					$(this).fadeIn('fast');
				})

				$('.progress span').css({top:0});
			}
			else
			{
				$(".title").text("I can haz beats?");
				$(".artist").html("&nbsp;");
			}
		});

		//Cover image arrives from Simplify!
		Simplify.listenEvent(PMEvents.CoverChange, function(cover)
		{
			if (cover == undefined)
			{
				return;
			}
		});

		//You can show controls over here, modify UI and so forth
		Simplify.listenEvent(PMEvents.InactiveMouseEnter, function()
		{
			$("body").stop().animate({"opacity": ".95"},500);
		});

		Simplify.listenEvent(PMEvents.InactiveMouseExit, function()
		{
			$("body").stop().animate({"opacity": ".85"},500);
		});

		function showMessage(msg) {
			Simplify.getTrackPlayedAmount(function(value)
			{
				if (value > .001) {
					$('#message').text('').removeClass('show');
					clearTimeout(timer);
					timer = null;
					$('#message').text(msg).addClass('show');
					timer = setTimeout(function(){
						$('#message').text('').removeClass('show');
					}, 1100);
				}
			});
		}
		</script>
	</head>
	<body>
		<div class="progress">
			<span></span>
		</div>
		<div class="jacket">
			<p><strong class="artist"> </strong> <span class="title">I can haz beats?</span></p>
		</div>
		<span id="message">paused</span>
	</body>
</html>
