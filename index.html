<!DOCTYPE html>
<html lang="en" xml:lang="en">
	<head>
		<meta name="jacket.title" content="Sidecar" />
		<meta name="jacket.author" content="Brett Terpstra" />
		<meta name="jacket.url" content="http://brettterpstra.com" />
		<meta name="jacket.version" content="1.4" />
		<meta name="jacket.bounds" content="300x1440" />
		<meta name="jacket.variations" content="I have the blues so bad, It's not easy being green, White riot, Black power, Almost invisible" />


		<link rel="stylesheet" type="text/css" href="index.css"  />
		<script type="text/javascript">

		//Draws circle with specified radius


		//When user changes jacket to yours, or Simplify starts with your jacket this event arrives
		Simplify.listenEvent(PMEvents.Ready, function(initial_state)
		{
			//This template jacket will fade in because of this line
			$("body").animate({"opacity": ".85"},2000);

			// if (Simplify.playerState() == PMPlayerState.Stopped)
			// {
			// 	$('.progress span').css({top:"100%"});
			// }
			// else
			// {
			// 	$('.progress span').css({top:0});
			// }
			$('.progress span').css({top:"100%"});
			var updateProgress = function()
			{
				if (Simplify.playerState() == PMPlayerState.Playing || Simplify.playerState() == PMPlayerState.Paused)
				{
					Simplify.getTrackPlayedAmount(function(value)
					{
						$('.progress span').css({top:(Math.round(value*100/0.01)*0.01).toString() + "%"});
					});
				}
			}

			updateProgress(), setInterval(updateProgress, 1000);

			$(".jacket").click(function(ev){
				ev.preventDefault();
				if (ev.metaKey) {
					var percentage = (ev.pageY - $(this).offset().top)/$(this).height();
					Simplify.setTrackSeeking(Simplify.getTrackLength() * percentage);
				} else {
					Simplify.togglePlayback();
				}
			});

			//Activating application on double click
			$("body, html").dblclick(function()
			{
				Simplify.nextTrack();
			});

		});

		//When variation changes, you can add/remove CSS-classes from body to keep track current variation
		Simplify.listenEvent(PMEvents.VariationChange, function(variation)
		{
			/* EXAMPLE CODE. IT WORKS! */

			if (variation.indexOf("I have the blues so bad") != -1)
			{
				$("body").addClass("blue");
			}
			else
			{
				$("body").removeClass("blue");
			}

			if (variation.indexOf("It's not easy being green") != -1)
			{
				$("body").addClass("green");
			}
			else
			{
				$("body").removeClass("green");
			}

			if (variation.indexOf("White riot") != -1)
			{
				$("body").addClass("white");
			}
			else
			{
				$("body").removeClass("white");
			}

			if (variation.indexOf("Black power") != -1)
			{
				$("body").addClass("black");
			}
			else
			{
				$("body").removeClass("black");
			}

			if (variation.indexOf("Almost invisible") != -1)
			{
				$("body").addClass("invisible");
			}
			else
			{
				$("body").removeClass("invisible");
			}

		});

		//UI modifications on playback changes
		Simplify.listenEvent(PMEvents.PlaybackStateChange, function(state)
		{
			if (state == PMPlayerState.Paused)
			{
				$('.progress').addClass('paused');
			}
			else if (state == PMPlayerState.Playing)
			{
				$('.progress').removeClass('paused');
			}
			else
			{
				$('.progress').removeClass('paused');
			}
		});

		//Track title arrived from Simplify
		Simplify.listenEvent(PMEvents.TrackInformationChange, function(artist, title, album)
		{
			//Undefined attributes means stopped playback.
			if (artist != undefined && title != undefined)
			{
				$(".title,.artist").fadeOut('fast',function() {
					$(".title").text(title);
					$(".artist").text(artist+" ");
					$(this).fadeIn('fast');
				})

				$('.progress span').css({top:0});
			}
			else
			{
				$(".title").text("I can haz beats?");
				$(".artist").html("&nbsp;");
			}
		});

		//Cover image arrives from Simplify!
		Simplify.listenEvent(PMEvents.CoverChange, function(cover)
		{
			if (cover == undefined)
			{
				return;
			}
		});

		//You can show controls over here, modify UI and so forth
		Simplify.listenEvent(PMEvents.InactiveMouseEnter, function()
		{
			$("body").animate({"opacity": "1"},500);
		});

		Simplify.listenEvent(PMEvents.InactiveMouseExit, function()
		{
			$("body").animate({"opacity": ".85"},500);
		});

		</script>
	</head>
	<body>
		<div class="progress">
			<span></span>
		</div>
		<div class="jacket">
			<p><strong class="artist"> </strong> <span class="title">I can haz beats?</span></p>
		</div>
	</body>
</html>
